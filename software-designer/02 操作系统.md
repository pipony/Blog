# 02 操作系统

## 概述

操作系统的角色：

- 管理系统的硬件、软件、数据资源
- 控制程序运行
- 人机之间的接口
- 应用软件与硬件之间的接口

管理分类：

- 进程管理
- 存储管理
- 文件管理
- 作业管理
- 设备管理

## 进程状态

三态模型

- 运行：万事具备
- 就绪：只等CPU资源
- 等待：除了CPU资源，还在等其他资源

![image-20220412221041687](http://cdn.huangxindi.com/img/image-20220412221041687.png)

五态模型

- 运行
- 静止就绪（运行过程中主动挂起）
- 活跃就绪
- 静止阻塞
- 活跃阻塞=等待

![image-20220412221053250](http://cdn.huangxindi.com/img/image-20220412221053250.png)

## 前趋图

![image-20220412221251142](http://cdn.huangxindi.com/img/image-20220412221251142.png)

## 同步与互斥

- 互斥：一个资源同时只能被一个进程所用
- 同步：速度有差异，一定情况下要等待

【注意】：两者不为相反的概念，互斥<->共享，同步<->异步

在生产者消费者问题，理解互斥和同步：如一个商场只能存放一件物品，若目前已有一件时，生产者无法将新的一件放入（互斥）；生产者是否可以放入也取决于消费者是否消费了这个物品，只有等消费者消费了，生产者才能新生产（同步）

## PV操作

### 概念

临界资源：进程间需要互斥访问的资源（如打印机，磁带机）

临界区：每个进程中访问临界资源的那段代码

信号量：一种特殊的变量，如P(s)中的s

P分配（减），V释放（加）

![image-20220412222459869](http://cdn.huangxindi.com/img/image-20220412222459869.png)

例子（单缓冲区）：

![image-20220412223033356](http://cdn.huangxindi.com/img/image-20220412223033356.png)

习题：

![image-20220412223518456](http://cdn.huangxindi.com/img/image-20220412223518456.png)

答案：A和C

## PV操作和前趋图

【重要！经常考！】

例题（答案：CAA）：

![image-20220413075716258](http://cdn.huangxindi.com/img/image-20220413075716258.png)

解题思路：信号量的赋值可根据从上到下、从左到右的原则赋值，出箭头设为V(s)，入箭头设为P(s)。如P1出箭头那里是V(S1)，P2出箭头那里是V(S2)，P3入箭头那里是P(S1)和P(S2)。

## 死锁

### 最小需要多少个资源不发生死锁

公式：k*(n-1)+1；k：进程数，n，每个进程需要的资源数

### 死锁四大条件

- 互斥
- 保持和等待
- 不剥夺
- 环路等待

### 解决死锁

- 预防：打破四大条件
- **避免**：有序资源分配法，**银行家算法**

### 银行家算法

例题：

![image-20220413081111136](http://cdn.huangxindi.com/img/image-20220413081111136.png)

![image-20220413081139531](http://cdn.huangxindi.com/img/image-20220413081139531.png)

## 存储管理

### 分区存储

- 首次适应法
- 最佳适应法（空闲区块按大小顺序链式排列，找最小能满足分配空间的内存块）
  - 内存碎片多
- 最差适应法（类似最佳，找最大能满足的内存块）
- 循环首次适应法（把可分配区块循环链接起来，下次就先看下一块能否分配，而不是从头开始匹配）
  - 分配均匀些

### 页式存储

把用户程序等分为固定大小的页，这样不需要一次性将全部程序导入内存才能运行

- 优点：利用率高，碎片小，分配及管理简单
- 缺点：增加系统开销；可能产生抖动现象

常考：**逻辑和物理地址的转换**

页表中记录了【页号】和对应的【块号】

![image-20220413082234561](http://cdn.huangxindi.com/img/image-20220413082234561.png)

![image-20220413082643145](http://cdn.huangxindi.com/img/image-20220413082643145.png)

【可参考上面的例题】逻辑转为物理地址的思路：逻辑地址由页号和块内地址组成：

1、找到页号和块内地址分别是几位表示：根据页面大小为4K，说明块内地址是用12位表示，也就是A29H，那么页号就是5；

2、根据页号5，找到对应的页帧号（也就是块号）为6，所以选D

找到淘汰页号的思路：

1、从状态位为1的（在内存中）中找

2、从访问位为0的（最近没访问）中找

所以选页号为1的页面

### 段式存储

组成：段号+段内地址

段的长度也不同，依据代码结构

优点：多道程序共享内存，各段程序修改互不影响

缺点：内存利用率低，内存碎片浪费大

![image-20220430191644863](http://cdn.huangxindi.com/img/image-20220430191644863.png)

### 段页式存储

![image-20220430191747252](http://cdn.huangxindi.com/img/image-20220430191747252.png)

结合段式和页式，先分段再分页

### 快表

小容量的相联存储器，放在cache，速度快。从硬件保证按内存并行查找。

### 页面置换算法

#### 页面淘汰算法分类

- 最优 OPT(optimal)：只存在理论上的，从整体序列来分析
- 随机算法
- 先进先出FIFO：有可能产生抖动
- 最近最少使用LRU：不会抖动

例题:

![image-20220430192652910](http://cdn.huangxindi.com/img/image-20220430192652910.png)

答案：B和C

没有使用快表：意味着访问一页，需要访问两次内存（第一次为查询页表）

考试有个潜在规则：读取指令时是算作一次，也就是说虽然横跨0和1页，但是缺页中断次数为1；但是读取操作数时，比如读取A，横跨2和3页，所以缺页中断次数为2

## 文件管理

### 索引文件结构

![image-20220430200655631](http://cdn.huangxindi.com/img/image-20220430200655631.png)

目的：扩充容量

例题：

![image-20220501110926768](http://cdn.huangxindi.com/img/image-20220501110926768.png)

答案：C和D

### 文件和树型目录结构

绝对路径/相对路径

### 空闲存储空间管理

#### 方法分类

- 空闲区表法（空闲文件目录）
- 空闲链表法
- **位示图法**（0，1分别代表空闲和占用）
- 成组链接法

#### 位示图法

例题：

![image-20220501111702177](http://cdn.huangxindi.com/img/image-20220501111702177.png)

(4195+1)/32=131.125

注意：位置是从0开始算 

答案：D和B

### 数据传输控制方式

#### 方式

- 程序控制方式（需要很多CPU参数，CPU持续发出查询指令）

- 程序中断方式（主动发中断）
- DMA方式（直接存取控制方式，专门的DMA控制器，CPU只要在开头介入即可）
- 通道
- 输入输出机

### 虚设备与SPOOLING技术

![image-20220501112453111](http://cdn.huangxindi.com/img/image-20220501112453111.png)

## 微内核操作系统

![image-20220501112758988](http://cdn.huangxindi.com/img/image-20220501112758988.png)









